---

---

<section
  id="eco-cup-1"
  class="absolute mx-auto left-1/2 -translate-x-1/2 drop-shadow-sm z-50 !aspect-square w-[90vw] md:max-w-lg -mb-[100%] opacity-0"
>
</section>

<script>
  import * as THREE from "three";
  import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
  // import { loadEnvironment, setRenderer } from "../../../../utils/gainMap";
  // import { loadEnvironment } from "../../../utils/env";

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  // setRenderer(renderer);

  const container = document.getElementById("eco-cup-1");
  // Set renderer size
  const setRelativeRendererSize = () => {
    if (!container || !container?.clientWidth)
      setTimeout(() => setRelativeRendererSize(), 300);

    const containerWidth = container?.clientWidth || 300;
    const containerHeight = container?.clientWidth || 300;

    renderer.setSize(containerWidth, containerHeight);
  };

  setRelativeRendererSize();

  window.addEventListener("resize", setRelativeRendererSize);

  renderer.setClearColor(0xffffff, 0);
  renderer.setAnimationLoop(animate);
  document.getElementById("eco-cup-1")!.appendChild(renderer.domElement);

  //   loadEnvironment().then((env) => {

  //   scene.environment = env;
  //   scene.background = null;

  // });

  // Load 3D Model
  const loader = new GLTFLoader();
  loader.load(
    "./Paper_Cup.glb",
    function (gltf) {
      const cup = gltf.scene;
      const textureLoader = new THREE.TextureLoader();

      const textures = textureLoader.load("./textures/texture-5.webp");

      // Materials
      const material1 = new THREE.MeshStandardMaterial({
        color: 0x000000, // Black color
        roughness: 0,
        metalness: 0,
      });

      const material2 = new THREE.MeshStandardMaterial({
        map: textures,
        color: new THREE.Color(1, 1, 1),
        roughness: 0.5,
        metalness: 0,
      });

      // Apply materials
      cup.traverse((child) => {
        if (child instanceof THREE.Mesh) {
          if (child.name === "Paper_Cup_Body") {
            child.material = material2;
          } else {
            child.material = material1;
          }
        }
      });

      // Floating effect
      gsap.to(cup.position, {
        y: "+=0.1",
        repeat: -1,
        yoyo: true,
        duration: 1.5,
        ease: "power1.inOut",
      });

      // Rotation
      gsap.to(cup.rotation, {
        y: "+=6.28",
        repeat: -1,
        duration: 10,
        ease: "none",
      });

      // Resize
      cup.scale.set(10, 10, 10);

      // Mouse movement effect for specific cup
      const onMouseMove = (event: MouseEvent) => {
        const x = (event.clientX / window.innerWidth - 0.5) * 2;
        const y = (event.clientY / window.innerHeight - 0.5) * -2;

        gsap.to(cup.rotation, {
          x: y * -0.1,
          z: x * 0.1,
          duration: 0.7,
          ease: "power2.out",
        });
      };

      container?.addEventListener("mouseenter", () => {
        document.addEventListener("mousemove", onMouseMove);
      });

      container?.addEventListener("mouseleave", () => {
        document.removeEventListener("mousemove", onMouseMove);
      });

      scene.add(cup);
    },
    undefined,
    function (error) {
      console.error(error);
    }
  );

  // Camera Position
  camera.position.set(0, 3.5, 5);
  camera.rotateX(-0.3);
  camera.rotateZ(0.2);
  // camera.position.set(0, 2.8, 3);
  // camera.rotateX(-0.3);
  function animate() {
    renderer.render(scene, camera);
  }
</script>
