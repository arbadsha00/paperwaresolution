<how-we-work>
  <section
    class="max-w-6xl mx-auto relative space-y-24 p-4 pt-40"
    id="company-how-we-work"
  >
    <div
      class="flex flex-col lg:flex-row items-start justify-between w-full h-full relative"
      id="company-how-we-work-content"
    >
      <h2
        class="text-3xl sm:text-5xl w-full font-poppins uppercase text-center font-black inline lg:hidden text-dark"
        id="company-how-we-work-title"
        data-aos="fade-up"
      >
        How we work?
      </h2>
      <div
        class="basis-1/2 shrink-0 p-10 relative space-y-10 invisible lg:visible"
        data-column-left
      >
        <h2
          class="text-3xl sm:text-5xl font-poppins uppercase text-center font-black text-dark"
          id="company-how-we-work-title"
          data-aos="fade-up"
        >
          How we work?
        </h2>
        <div class="relative">
          <div
            data-scroll-index-0
            class="company-how-we-work-attachments font-poppins absolute top-0 font-semibold text-4xl p-2 bg-slate-300 border w-full min-h-96 rounded-3xl flex flex-row items-center justify-center"
          >
            <p class="text-center">Mordern Plant<br />Attachment</p>
          </div>
          <div
            data-scroll-index-1
            class="company-how-we-work-attachments font-poppins absolute top-10 font-semibold text-4xl p-2 bg-slate-400 border w-full min-h-96 rounded-3xl flex flex-row items-center justify-center"
          >
            <p class="text-center">Control Room<br />Attachment</p>
          </div>
          <div
            data-scroll-index-2
            class="company-how-we-work-attachments font-poppins absolute top-20 font-semibold text-4xl p-2 bg-slate-500 border w-full min-h-96 rounded-3xl flex flex-row items-center justify-center"
          >
            <p class="text-center">Lab<br />Attachment</p>
          </div>
        </div>
      </div>
      <div
        class="basis-1/2 md:p-10 space-y-20 font-poppins max-w-lg mx-auto lg:max-w-none lg:mx-0"
        data-column-right
      >
        <div
          class="space-y-10 lg:min-h-[80vh]"
          data-scroll-index-0
          data-aos="fade-up"
        >
          <h3
            class="text-3xl font-poppins uppercase font-black text-dark"
            data-aos="fade-up"
          >
            Modern Plant
          </h3>
          <div
            class="font-poppins lg:hidden font-semibold text-4xl p-2 bg-slate-300 border w-full min-h-96 rounded-3xl flex flex-row items-center justify-center"
            data-aos="fade-up"
          >
            <!-- Attachment Here -->
            <p class="text-center">Attachment<br />Here</p>
          </div>
          <div class="space-y-4 text-sm lg:text-lg" data-aos="fade-up">
            <p>
              <strong>Our Vision:</strong> A world free from plastic pollution, achieved
              through our commitment to exceptional quality and unwavering sustainability
            </p>
            <p>
              <strong>Key Features:</strong>
            </p>
            <ul class="space-y-2">
              <li>
                <strong>Prioritizing Excellence:</strong> Strict standards, skilled
                professionals, and continuous improvement ensure top-tier products
              </li>
              <li>
                <strong>Championing Sustainability:</strong> Eco-friendly materials,
                responsible sourcing, and minimal waste contribute to a healthier
                planet
              </li>
              <li>
                <strong>Energy Efficient:</strong> Solar-powered operations reducing
                carbon footprint by 40%
              </li>
            </ul>
          </div>
        </div>

        <!-- Control Room Section -->
        <div
          class="space-y-10 lg:min-h-[80vh]"
          data-scroll-index-1
          data-aos="fade-up"
        >
          <h3
            class="text-3xl font-poppins uppercase font-black text-dark"
            data-aos="fade-up"
          >
            Control Room
          </h3>
          <div
            class="font-poppins lg:hidden font-semibold text-4xl p-2 bg-slate-300 border w-full min-h-96 rounded-3xl flex flex-row items-center justify-center"
            data-aos="fade-up"
          >
            <!-- Attachment Here -->
            <p class="text-center">Attachment<br />Here</p>
          </div>
          <div class="space-y-4 text-sm lg:text-lg" data-aos="fade-up">
            <p>
              <strong>Our Mission:</strong> 24/7 intelligent monitoring ensuring
              flawless production
            </p>
            <p>
              <strong>Advanced Systems:</strong>
            </p>
            <ul class="space-y-2">
              <li>
                <strong>Real-Time Monitoring:</strong> Tracking of 200+ production
                metrics with AI-powered dashboards
              </li>
              <li>
                <strong>Automated Alerts:</strong> Instant anomaly detection minimizing
                downtime to under 2%
              </li>
              <li>
                <strong>Data Analytics:</strong> Machine learning optimizing material
                usage by 18% annually
              </li>
              <li>
                <strong>Centralized Control:</strong> Unified management of all production
                stages
              </li>
            </ul>
          </div>
        </div>

        <!-- Quality Lab Section -->
        <div
          class="space-y-10 lg:min-h-[80vh]"
          data-scroll-index-2
          data-aos="fade-up"
        >
          <h3
            class="text-3xl font-poppins uppercase font-black text-dark"
            data-aos="fade-up"
          >
            Quality Lab
          </h3>
          <div
            class="font-poppins lg:hidden font-semibold text-4xl p-2 bg-slate-300 border w-full min-h-96 rounded-3xl flex flex-row items-center justify-center"
            data-aos="fade-up"
          >
            <!-- Attachment Here -->
            <p class="text-center">Attachment<br />Here</p>
          </div>
          <div class="space-y-4 text-sm lg:text-lg" data-aos="fade-up">
            <p>
              <strong>Our Standard:</strong> Where science meets sustainability
            </p>
            <p>
              <strong>Testing Protocols:</strong>
            </p>
            <ul class="space-y-2">
              <li>
                <strong>Durability Testing:</strong> Stress-testing under extreme
                temperatures and pressures
              </li>
              <li>
                <strong>Food Safety:</strong> FDA-compliant material checks for all
                food-contact surfaces
              </li>
              <li>
                <strong>Eco-Decomposition:</strong> BPI-certified compostability
                within 90 days
              </li>
              <li>
                <strong>Material Innovation:</strong> Developing plant-based waterproof
                coatings
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>
</how-we-work>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);
  gsap.ticker.lagSmoothing(0);

  const attachments = gsap.utils.toArray<HTMLElement>(
    ".company-how-we-work-attachments"
  );

  // Animation timeline
  gsap.timeline({
    scrollTrigger: {
      trigger: "#company-how-we-work",
      start: "top top",
      end: "bottom bottom",
      pinSpacing: false, // keeps layout tight
      scrub: false,
      pin: "[data-column-left]",
      anticipatePin: 1,
      // Disable these if causing issues
      // onEnter: () => document.body.classList.add('no-scroll'),
      // onLeave: () => document.body.classList.remove('no-scroll')
    },
  });

  attachments.forEach((attachment, index) => {
    gsap.fromTo(
      attachment,
      {
        opacity: 0,
        y: 30,
      },
      {
        opacity: 1,
        y: 0,
        scrollTrigger: {
          trigger: `[data-column-right] [data-scroll-index-${index}]`,
          start: "top center",
          toggleActions: "play none none reverse",
          // markers: true,
        },
      }
    );

    Array.from({ length: attachments?.length }, (_, i) => i)?.forEach(
      (contentNumber) => {
        gsap.fromTo(
          attachment,
          {
            scale: 1 - (contentNumber - index) * 0.1,
          },
          {
            scale: 1 - (contentNumber - index) * 0.1 - 0.1,
            // y: "+=",
            scrollTrigger: {
              trigger: `[data-column-right] [data-scroll-index-${contentNumber}]`,
              start: "top center",
              toggleActions: "play none none reverse",
            },
          }
        );
      }
    );
  });
</script>
